<!DOCTYPE html>
<html>

<!-- In the second version of the experiment I will create a timeline to run the experiment. The timeline is an ordered set of
trials -->
    <head>
        <!-- set up initial parameters, define paths -->
        <title> Lexical Decision </title>
        <script src="jspsych/jspsych.js"></script>
        <script src="jspsych/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="jspsych/plugins/jspsych-instructions.js"></script>
        <link href="jspsych/css/jspsych.css" rel="stylesheet">
    </head>
    <body></body>

    <!-- start with experimental parameters. In this first version, I just create a simple design with intrsuctions, 
        fixation, ITI and 1 trial for each of the 2 conditions. Creating a list of trials and running a full LEXDEC task happens in version 2. -->
    <script>
        var timeline = []; // create empty object list that will be filled with data in loop, later 

        // start with adding instructions object
        var instructions = {
            type: 'instructions', // what is thr type of the plugin?
            pages: ['welcome!', 'Press the f key when you see a non-word. </p><p>Press the j key when you see a word.', 'Click the NEXT button to start.'], // text seperated with coma denotes different page
            show_clickable_nav: true, // an option taht allows participants to navigate through pages when reading instructions
        };

        // add instructions to the timeline 
        timeline.push(instructions);

        // add a fixation object
        var fixation = {
            type: 'html-keyboard-response',  // type of plugin
            stimulus: '<span style="font-size:40px;">+</span>', // change format (fontsize) using html command <span>
            choices: jsPsych.NO_KEYS, // spcial case because we don't want a respnse in the fixation
            trial_duration: 1000
        };

        // create a trial example
        var lexdec_trial = {
            type: 'html-keyboard-response',  // type of plugin
            stimulus: jsPsych.timelineVariable('stimulus'),
            choices: ['f', 'j'],  // response choices
            prompt: 'f = not word, j = word', // if also added in the instructions (not needed)
            stimulus_duration: 2000,  // stimulus presentation time
            data: {
                condition: jsPsych.timelineVariable('condition'), 
                correct_response: jsPsych.timelineVariable('correct_response')
            }, // define a condition (a way to make sure that participant responded corretly)
            
            post_trial_gap: 1000, // ITI
            
            // compute correct responses 
            on_finish: function(data) {
                if(jsPsych.pluginAPI.compareKeys(data.correct_response, data.key_press)){
                    data.correct = true;
                } else {
                    data.correct = false; 
                }
            }
        }; // trials

        var feedback = {
            type: 'html-keyboard-response',  // type of plugin
            stimulus: function() {
                var feedback_text = '<span style="font-size:30px;color:red;">Oh no! Incorrect</span>';
                var last_trial_accuracy = jsPsych.data.getLastTrialData().values()[0].correct; // get data from last trial
                if (last_trial_accuracy == true) {
                    feedback_text = '<span style="font-size:30px;color:green;">Correct! Well done!</span>' // if participant responded correctly congratulate
                }
                return feedback_text
            },
            choices: jsPsych.NO_KEYS,
            trial_duration: 3000
        }

        // create timeline variables with information for each trial
        var trial_info = [
            {stimulus: '<span style="font-size:40px;">apple</span>', condition: 'word', correct_response: 'j'},
            {stimulus: '<span style="font-size:40px;">tree</span>', condition: 'word', correct_response: 'j'},
            {stimulus: '<span style="font-size:40px;">moxid</span>', condition: 'nonword', correct_response: 'f'},
            {stimulus: '<span style="font-size:40px;">orap</span>', condition: 'nonword', correct_response: 'f'}
            
        ];

        // create a new object for the trials procedure 
        var lexdec_procedure = {
            timeline: [fixation, lexdec_trial, feedback], // define the trial types (e.g., fixation and stim presentation)
            timeline_variables: trial_info,
            randomize_order: true, // randomise trials
            repetitions: 2 // repetitions of conditions/stimuli
        }

        timeline.push(lexdec_procedure);

        jsPsych.init({
            timeline: timeline,
            on_finish: function(){
                jsPsych.data.displayData(); // display output at the end 
            }
        })

    </script>
</html>
